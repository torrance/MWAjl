<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Sky Model · MWAjl Documentation</title><link href="https://fonts.googleapis.com/css?family=Lato|Roboto+Mono" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.11.1/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link href="../assets/styles.css" rel="stylesheet" type="text/css"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit">MWAjl Documentation</span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">MWAjl</a></li><li class="is-active"><a class="tocitem" href>Sky Model</a><ul class="internal"><li><a class="tocitem" href="#skymodel-fileformat-1.1-1"><span>skymodel fileformat 1.1</span></a></li><li><a class="tocitem" href="#Example-skymodels-1"><span>Example skymodels</span></a></li><li><a class="tocitem" href="#Measurement-interpolation-rules-1"><span>Measurement interpolation rules</span></a></li></ul></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Sky Model</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Sky Model</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/torrance/MWAjl/blob/master/docs/src/skymodel.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Sky-Model-1"><a class="docs-heading-anchor" href="#Sky-Model-1">Sky Model</a><a class="docs-heading-anchor-permalink" href="#Sky-Model-1" title="Permalink"></a></h1><p>A sky model consists of one of more named sources. Each source consists of one or more emission components with properties that describe their respective position on the sky, type, and emission spectrum. This information can be used to describe both bright calibrator sources (like Cygnus A, for example) or an entire field of view of fainter, smaller, point sources. And either can be used as a model to obtain a calibration solution.</p><p>This page describes the format used in sky model files, passed to calibrate using the <code>--model</code> parameter. This page also describes how some of these sky model parameters are interpreted and processed.</p><ul><li><a href="#Sky-Model-1">Sky Model</a></li><ul><li><a href="#skymodel-fileformat-1.1-1">skymodel fileformat 1.1</a></li><ul><li><a href="#Syntax-1">Syntax</a></li><li><a href="#Format-1">Format</a></li></ul><li><a href="#Example-skymodels-1">Example skymodels</a></li><ul><li><a href="#A-single-point-source-with-measurements-1">A single point source with measurements</a></li><li><a href="#A-single-point-source-with-SED-1">A single point source with SED</a></li><li><a href="#A-multicomponent-source-with-mixed-component-types-1">A multicomponent source with mixed component types</a></li></ul><li><a href="#Measurement-interpolation-rules-1">Measurement interpolation rules</a></li></ul></ul><h2 id="skymodel-fileformat-1.1-1"><a class="docs-heading-anchor" href="#skymodel-fileformat-1.1-1">skymodel fileformat 1.1</a><a class="docs-heading-anchor-permalink" href="#skymodel-fileformat-1.1-1" title="Permalink"></a></h2><h3 id="Syntax-1"><a class="docs-heading-anchor" href="#Syntax-1">Syntax</a><a class="docs-heading-anchor-permalink" href="#Syntax-1" title="Permalink"></a></h3><p>Keywords and tokens are required to be separated by white space (one more or of spaces, tabs, new lines), with the exception of braces (<code>{</code> or <code>}</code>) which are understood as complete keywords.</p><p>Single quotes (<code>&#39;</code>) or double quotes (<code>&quot;</code>) can be used around a strings containing white space, for example in source names like <code>&quot;Crab Nebula&quot;</code> or <code>&#39;Fornax A&#39;</code>, so long as the opening and closing quotes match. There are no escape characters for within quoted strings.</p><p>The format is otherwise not white-space sensitive: new lines, spaces and tabs can be used to format the file as desired.</p><p>Comments are indicated by a <code>#</code> symbol and will exclude all proceeding text until the next new line from further processing.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The function <code>gettoken()</code> can be referenced for further clarity about token parsing.</p></div></div><article class="docstring"><header><a class="docstring-binding" id="MWAjl.gettoken" href="#MWAjl.gettoken"><code>MWAjl.gettoken</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">gettoken(f::IOStream)::String</code></pre><p>Parses the head of <code>f::IOSteam</code> and stops when a complete token has been parsed, which is returned. All tokens are lowercased on return.</p><p>This function has the side effect of advancing the position of the IOStream.</p><p>Tokens are defined as any whitespace (spaces, tabs, newlines, etc.) delimited text with two exceptions: both <code>{</code> and <code>}</code> are considered complete tokens and do not necessarily require surrounding white space; and any token begining with a quote (either <code>&#39;</code> or <code>&#39;&#39;</code>) will only conclude upon reaching a matching quote character (which will be stripped from the token). There are no escape characters. Comments are indicated by a <code>#</code> symbol and will exclude all text to the right until the next new line.</p></div><a class="docs-sourcelink" target="_blank" href="https://github.com/torrance/MWAjl/blob/099826b5b2255b07b5570bbd00b5828cd424545c/src/skymodel_parser.jl#L330-L344">source</a></section></article><h3 id="Format-1"><a class="docs-heading-anchor" href="#Format-1">Format</a><a class="docs-heading-anchor-permalink" href="#Format-1" title="Permalink"></a></h3><p>The sky model file must include the following header as the first non-whitespace text:</p><pre><code class="language-none">skymodel fileformat 1.1</code></pre><p>Following this, any number of sources may be provided:</p><pre><code class="language-none">source {
    name &quot;Source name&quot;
    component { ... } [component { ... }, ...]
}</code></pre><p>A <strong>source</strong> provides a representation of a radio object. For a typical point-like source on the sky, a source will have just one component. For larger or more complex sources, a source may have hundreds or even thousands of components.</p><p>Each source must have a <code>name</code>, and optionally 0 or more components.</p><pre><code class="language-none">component {
    position 00h00m00.0s 00d00m00.0s
    type {point | gaussian}
    [shape 150 120 30]
    [measurement {...}, ...] | sed{...}]
}</code></pre><p>A <strong>component</strong> describes emission originating from a single direction in the sky. Each component must have a position, a type and spectrum.</p><p>The <code>position</code> describes the J2000 RA and Dec coordinates of the emission and must be in the sexagesimal format illustrated above, using the &#39;h&#39;, &#39;m&#39; and &#39;s&#39; characters for RA and &#39;d&#39;, &#39;m&#39;, &#39;s&#39; for Dec. No other format is accepted.</p><p>The <code>type</code> of the component can be a point source or a Gaussian. A point source is represented analytically in the measurement equation as a Dirac delta function.</p><p>A gaussian source requires the additional parameter <code>shape</code> which describes the major and minor axis (arcseconds) and a position angle (degrees). <em><strong>ToDo:</strong> Which direction is the angle measured from?</em></p><p>Each component must also contain spectrum information. The spectrum describes the flux of the source as a function of frequency. This is provided in one of two ways: either as one or more measurements at specified frequencies, or as a spectral energy distrbution (SED).</p><p>A <strong>measurement</strong> is of the format:</p><pre><code class="language-none">measurement {
  frequency 100 MHz
  fluxdensity Jy 100 2 2 0
}</code></pre><p>The <code>frequency</code> field describes the frequency at which the meausurement was taken. The unit <code>MHz</code> must be appended, and this is the only unit currently accepted. Other units like <code>GHz</code> will throw an error.</p><p><code>fluxdensity</code> describes the measured flux of the component at the specified frequency in units of Jansky in Stokes I, Q, U, V, respectively. The unit <code>Jy</code> must be provided, and is the only unit currently accepted.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The flux density is the total/integrated flux of the source [Jy], not the peak flux [Jy / beam]. For point sources these values are identical, but for Gaussian sources they are not.</p></div></div><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p><a href="#measurement-interpolation-rules">See below</a> for the rules for how flux density is interpolated in frequency when using measurements.</p></div></div><p>An <strong>SED</strong> is an alternative to providing one more more measurements. It allows for complete control over how the spectrum is interpolated in frequency by specifying arbitrary Taylor terms describing the curve:</p><div>\[\log(S) = \log(S_0) + \alpha \log(\nu - \nu_0) + \beta \log(\nu - \nu_0)^2 + ...\]</div><p>The format for specifying an SED is as follows:</p><pre><code class="language-none">sed {
  frequency 154 MHz
  fluxdensity Jy 100 0 0 0
  spectral-index { -0.7 [...] }
}</code></pre><p>The <code>frequency</code> field specifies the reference frequency <span>$\nu_0$</span>. Only <code>MHz</code> is accepted.</p><p>The <code>fluxdensity</code> specifies the flux density <span>$S_0$</span> measured at the reference frequency in units of Jansky in Stokes I, Q, U, V, respectively. The unit <code>Jy</code> must be provided, and is the only unit currently accepted. The flux density is the total/integrated flux of the source.</p><p>The spectral index describes the Taylor terms of the curve in log/log space, i.e. <span>$\alpha$</span>, <span>$\beta$</span>, etc. At least one Taylor term must be provided, however there is no limit to the number of coefficients that are accepted.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>The SED curve applies to all of the Stokes parameters, and there is not currently any way to specify unique curves for each.</p></div></div><h2 id="Example-skymodels-1"><a class="docs-heading-anchor" href="#Example-skymodels-1">Example skymodels</a><a class="docs-heading-anchor-permalink" href="#Example-skymodels-1" title="Permalink"></a></h2><h3 id="A-single-point-source-with-measurements-1"><a class="docs-heading-anchor" href="#A-single-point-source-with-measurements-1">A single point source with measurements</a><a class="docs-heading-anchor-permalink" href="#A-single-point-source-with-measurements-1" title="Permalink"></a></h3><pre><code class="language-none">skymodel fileformat 1.1
source {
  name &quot;J035857+102702&quot;
  component {
    type point
    position 03h58m57.7099s +10d27m17.892s
    measurement {
      frequency 80 MHz
      fluxdensity Jy 46.75907 0 0 0
    }
    measurement {
      frequency 100 MHz
      fluxdensity Jy 39.73867 0 0 0
    }
    measurement {
      frequency 120 MHz
      fluxdensity Jy 34.80545 0 0 0
    }
  }
}</code></pre><h3 id="A-single-point-source-with-SED-1"><a class="docs-heading-anchor" href="#A-single-point-source-with-SED-1">A single point source with SED</a><a class="docs-heading-anchor-permalink" href="#A-single-point-source-with-SED-1" title="Permalink"></a></h3><pre><code class="language-none">source {
  name &quot;Crab&quot;
  component {
    type point
    position 05h34m28.1s 22d02m09s
    sed {
      frequency 154 MHz
      fluxdensity Jy 87.0601723 0 0 0
      spectral-index { -0.22 0.00 }
    }
  }
}</code></pre><h3 id="A-multicomponent-source-with-mixed-component-types-1"><a class="docs-heading-anchor" href="#A-multicomponent-source-with-mixed-component-types-1">A multicomponent source with mixed component types</a><a class="docs-heading-anchor-permalink" href="#A-multicomponent-source-with-mixed-component-types-1" title="Permalink"></a></h3><pre><code class="language-none">source {
  name &quot;J232013-132102A&quot;
  component {
    type gaussian
    position 23h20m10.1296s -13d19m47.316s
    shape 185.821633 159.627594 -89.000000
    sed {
      frequency 154 MHz
      fluxdensity Jy 87.0601723 0 0 0
      spectral-index { -0.22 0.00 }
    }
  }
  component {
    type point
    position 23h20m17.9149s -13d22m31.836s
    measurement {
      frequency 80 MHz
      fluxdensity Jy 0.27617 0 0 0
    }
    measurement {
      frequency 240 MHz
      fluxdensity Jy 0.15225 0 0 0
    }
  }
}</code></pre><h2 id="Measurement-interpolation-rules-1"><a class="docs-heading-anchor" href="#Measurement-interpolation-rules-1">Measurement interpolation rules</a><a class="docs-heading-anchor-permalink" href="#Measurement-interpolation-rules-1" title="Permalink"></a></h2><p>When specifying a component spectrum using measurements, it is usually necessary for calibrate to interpolate in frequency between the specified measurements. These rules follow exactly the rules used by the original claibrate, as well as handling all edge cases.</p><p>The rules for how this works are best described by the documentation of the implementing function:</p><article class="docstring"><header><a class="docstring-binding" id="MWAjl.stokes" href="#MWAjl.stokes"><code>MWAjl.stokes</code></a> — <span class="docstring-category">Function</span></header><section><div><pre><code class="language-julia">stokes(ms::Measurements, ν::Float64)</code></pre><p>Given a Measurements object (containing one more more Measurement objects), interpolate each of Stokes I, Q, U, V to the frequency ν.</p><p>This function has been implemented to identically match the behaviour of the original <code>calibrate</code>.</p><p>We interpolate in three ways:</p><ol><li>If just one measurement is provide, we assume a flat spectral index (i.e. constant).</li><li>If the frequency ν lies between two measured values, we linearly interpolate (in log/log space) between these values. EXCEPT if either of the two neighbour values is &lt;= 0, then we linearly interpolate in linear space between the two neighbouring measurements.</li><li>Otherwise, we linearly interpolate in log/log space based on a least squares fit to <em>all</em>  strictly positive measurements. If none are strictly positive, we return 0. If just one is strictly positive, the spectrum is assumed flat.</li></ol><div class="admonition is-warning"><header class="admonition-header">Warning</header><div class="admonition-body"><p>There are plenty of pathological combinations of measurement values that will give unexpected results. For example, given measurements 100 MHz =&gt; 1 Jy and 200 MHz =&gt; 0 Jy, then requesting the flux density at 300 MHz will give 1 Jy.</p><p>To avoid such unexpected results, ensure all measurements are strictly positive (i.e. &gt; 0).</p><p>Or for complete control over interpolation, it is recommended to instead provide an SED.</p></div></div></div><a class="docs-sourcelink" target="_blank" href="https://github.com/torrance/MWAjl/blob/099826b5b2255b07b5570bbd00b5828cd424545c/src/skymodel.jl#L94-L117">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« MWAjl</a></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> on <span class="colophon-date" title="Friday 22 May 2020 16:27">Friday 22 May 2020</span>. Using Julia version 1.4.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
